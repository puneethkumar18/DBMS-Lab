-- CREATING SAILORS DATABASE

CREATE DATABASE SAILORS;

-- USING SAILORS DATABASES

USE SAILORS;

-- CREATING SAILORS TABLE

CREATE TABLE SAILORS(
SID INT PRIMARY KEY,
SNAME VARCHAR(25),
RATING FLOAT,
AGE INT
);

-- CREATING BOAT TABLE

CREATE TABLE BOAT(
BID INT PRIMARY KEY,
BNAME VARCHAR(20),
COLOR VARCHAR(20)
);

-- CREATING RESERVERS TABLE

CREATE TABLE RESERVERS(
SID INT,
BID INT, 
DATE DATE,
PRIMARY KEY(SID,BID),
FOREIGN KEY (BID) REFERENCES BOAT(BID),
FOREIGN KEY(SID) REFERENCES SAILORS(SID)
);

-- INSERT DATA INTO SAILORS

INSERT INTO SAILORS (SID,SNAME,RATING,AGE)
VALUES
(101,'SAILOR 1',4.5,33),
(102,'SAILOR 2',3.9,40),
(103,'SAILOR 3',4.4,38),
(104,'SAILOR 4',4.9,32),
(105,'SAILOR 5',5.0,29);

-- INSERT DATA INTO BOAT

INSERT INTO BOAT(BID,BNAME,COLOR)
VALUES
(201,'BOAT 1','BLUE'),
(202,'BOAT 2','RED'),
(203,'BOAT 3','GREEN'),
(204,'BOAT 4','YELLOW'),
(205,'BOAT 5','WHITE');


-- INSERT DATA INTO RESERVERS

INSERT INTO RESERVERS(SID,BID,DATE)
VALUES
(101,201,'2023-07-01'),
(102,202,'2023-07-11'),
(103,203,'2023-07-21'),
(104,204,'2023-08-01'),
(105,205,'2023-08-11');

-- TO SHOW TABLE

SELECT * FROM SAILORS;


-- Find the colours of the boats reserved by Albert

SELECT COLOR FROM  RESERVERS R,BOAT B,SAILORS S
WHERE S.SID = R.SID AND R.BID = B.BID AND SNAME = 'ALBERT';

-- Find all the sailor sids who have rating atleast 8 or reserved boat 203

(SELECT SID FROM SAILORS
WHERE RATING > 4)
UNION
(SELECT SID FROM RESERVERS
WHERE BID = 203);

-- Find the names of the sailor who have not reserved a boat whose name contains the string "storm". Order the name in the ascending order

SELECT S.SNAME FROM SAILORS S
WHERE S.SNAME NOT IN
(SELECT S1.SNAME FROM RESERVERS R , SAILORS S1
WHERE R.SID = S1.SID)
AND S.SNAME LIKE "%STROM%"
ORDER BY S.SNAME DESC;

-- Find the name of the sailors who have reserved all boats

SELECT S.SNAME FROM SAILORS S WHERE NOT EXISTS 
(SELECT * FROM BOAT B WHERE NOT EXISTS
(SELECT * FROM RESERVERS R WHERE R.SID=S.SID AND R.BID=B.BID));

-- For each boat which was reserved by atleast 2 sailors with age >= 40, find the bid and average age of such sailors

SELECT B.BID ,AVG(S.AGE) AS AVG_AGE
FROM SAILORS S ,RESERVERS R ,BOAT B
WHERE R.SID = R.BID AND R.BID=B.BID  AND S.AGE>40 
GROUP BY BID
HAVING COUNT(S.SID)>=2;